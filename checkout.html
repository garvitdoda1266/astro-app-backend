<!DOCTYPE html>
<html>
<head>
  <title>Razorpay Wallet Test</title>
  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
</head>
<body>
  <h1>Add Money to Wallet</h1>
  <input type="number" id="amount" placeholder="Amount in INR" />
  <button onclick="pay()">Pay</button>

  <script>
    async function pay() {
      const amount = document.getElementById('amount').value;

      // Step 1: Create order on backend
      const orderRes = await fetch('http://localhost:5001/wallet/add-money', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ user_id: '6900cf879d255872d11e138f', amount: parseInt(amount) })
      });
      const order = await orderRes.json();

      // Step 2: Open Razorpay checkout
      const options = {
        key: "rzp_test_RY0G1ciZ5hPf3O", // your test key_id
        amount: order.amount,
        currency: order.currency,
        order_id: order.id,
        name: "My Wallet App",
        description: "Add Money",
        handler: async function(response) {
          // Step 3: Verify payment and update wallet
          const verifyRes = await fetch('http://localhost:5001/wallet/verify-payment', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              payment_id: response.razorpay_payment_id,
              user_id: '6900cf879d255872d11e138f',
              amount: parseInt(amount)
            })
          });
          const result = await verifyRes.json();
          alert(result.message);
        },
        prefill: { name: "Test User", email: "test@example.com" },
        theme: { color: "#528FF0" }
      };

      const rzp = new Razorpay(options);
      rzp.open();
    }
  </script>
</body>
</html>
